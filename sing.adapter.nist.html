<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>sing.adapter.nist documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Sing 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li class="current"><a href="sing.adapter.nist.html"><span>sing.adapter.nist</span></a></li><li><a href="sing.adapter.nist.core.html"><span>sing.adapter.nist.core</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="sing.adapter.nist.html#var-run-nist"><span>run-nist</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>sing.adapter.nist documentation</h2><pre class="doc">Adapter for the nist implemention of JAIN.

It provider a ring like api for SIP.
A typical completed request is looks like:
  {:method         :invite
   :uri            &quot;sip:bob@biloxi.com&quot;
   :local-addr     &quot;192.0.2.1&quot;
   :local-port     &quot;5060&quot;
   :remote-addr    &quot;192.0.2.2&quot;
   :remote-port    &quot;5060&quot;
   :via            [&quot;SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8&quot;]
   :call-id        &quot;a84b4c76e66710&quot;
   :cseq           314159
   :from           &quot;Alice &lt;sip:alice@atlanta.com&gt;;tag=1928301774&quot;
   :to             &quot;Bob &lt;sip:bob@biloxi.com&gt;&quot;
   :max-forwards   70
   :headers        {&quot;via&quot;            &quot;SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8&quot;
                    &quot;call-id&quot;        &quot;a84b4c76e66710&quot;
                    &quot;cseq&quot;           &quot;314159 INVITE&quot;
                    &quot;from&quot;           &quot;Alice &lt;sip:alice@atlanta.com&gt;;tag=1928301774&quot;
                    &quot;to&quot;             &quot;Bob &lt;sip:bob@biloxi.com&gt;&quot;
                    &quot;max-forwards&quot;   &quot;70&quot;
                    &quot;contact&quot;        &quot;&lt;sip:alice@pc33.atlanta.com&gt;&quot;
                    &quot;content-type&quot;   &quot;application/sdp&quot;
                    &quot;content-length&quot; &quot;142&quot;}
   :content-type   &quot;application/sdp&quot;
   :content-length 142
   :content        ... (Alice's SDP not shown)}

A typical completed response is looks like:
  {:status         200
   :reason         &quot;OK&quot;
   :final?         true
   :local-addr     &quot;192.0.2.4&quot;
   :local-port     &quot;5060&quot;
   :remote-addr    &quot;192.0.2.3&quot;
   :remote-port    &quot;5060&quot;
   :via            &quot;SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8;received=192.0.2.1&quot;
   :call-id        &quot;a84b4c76e66710&quot;
   :cseq           314159
   :from           &quot;Alice &lt;sip:alice@atlanta.com&gt;;tag=1928301774&quot;
   :to             &quot;Bob &lt;sip:bob@biloxi.com&gt;;tag=a6c85cf&quot;
   :headers        {&quot;via&quot; &quot;SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8;received=192.0.2.1&quot;
                    &quot;to&quot; &quot;Bob &lt;sip:bob@biloxi.com&gt;;tag=a6c85cf&quot;
                    &quot;from&quot; &quot;Alice &lt;sip:alice@atlanta.com&gt;;tag=1928301774&quot;
                    &quot;call-id&quot; &quot;a84b4c76e66710&quot;
                    &quot;cseq&quot; &quot;314159 INVITE&quot;
                    &quot;contact&quot; &quot;&lt;sip:bob@192.0.2.4&gt;&quot;
                    &quot;content-type&quot; &quot;application/sdp&quot;
                    &quot;content-length&quot; &quot;131&quot;}
   :content-type   &quot;application/sdp&quot;
   :content-length 131
   :content        ... (Bob's SDP not shown)}</pre><div class="public" id="var-run-nist"><h3>run-nist</h3><div class="usage"><code>(run-nist handler options)</code></div><pre class="doc">Start a nist SIP stack to serve the given handler according to the supplied options:

:configurator - a function called with the SipProvider instance
:host         - the hostname to listen on (default to 0.0.0.0)
:port         - the port to listen on (default to 5060)
:name         - the name of stack (default to sing-version)
:tcp?         - use TCP transport (default to false)
:udp?         - use UDP transport (default to true)

The 'handler' argument is a function that take one parameter. When nist received a SIP request
from peer. It will call the handler function with a completed request map. And the handler
function must return a response map or nil if the request is an ACK. Then the response map will
send to peer by nist.

Because the most of headers of response will copy from the request, so you just need return a
response map that contains :status. When necessary, you can add :content-type, :content and
other addition :headers to the response map.

the function return a map contains two functions.
  :close        it take no parameter, call it to close the nist.
  :send-request it take one request map, call it to send a sip request.
                A sip request map argument is looks like
                  {:method         :invite
                   :uri            &quot;sip:bob@biloxi.com&quot;
                   :via            [&quot;SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8&quot;]
                   :call-id        &quot;a84b4c76e66710&quot;
                   :cseq           314159
                   :from           &quot;Alice &lt;sip:alice@atlanta.com&gt;;tag=1928301774&quot;
                   :to             &quot;Bob &lt;sip:bob@biloxi.com&gt;&quot;
                   :max-forwards   70
                   :content-type   &quot;application/sdp&quot;
                   :content        ... (Alice's SDP not shown, could be a byte array, a string or others)}

                This function will return a 'promise' immediately. when nist receive the response from UAS,
                the promise will be realized to a response map. Otherwise, it will be realized to a keyword
                that indicate the reason for failure.</pre></div></div></body></html>